---
â­•ì²« í•™ìŠµë‚ : 2024-08-14
â­•ê³¼ëª©: Kubernetes
â¤1ì¼ë³µìŠµì—¬ë¶€: false
ğŸ§¡4ì¼ë³µìŠµì—¬ë¶€: false
ğŸ’›7ì¼ë³µìŠµì—¬ë¶€: false
ğŸ’š14ì¼ë³µìŠµì—¬ë¶€: false
ğŸ§ ì¥ê¸°ê¸°ì–µ: false
ë³µìŠµ: 1ì¼ ë³µìŠµ
ğŸ›‘ì²«ë‚ : "âœì²«ë‚  : 2024/08/14"
ğŸ›‘ì˜¤ëŠ˜: "â°ì˜¤ëŠ˜ : 2024/10/27"
ğŸ›‘ì²«í•™ìŠµí›„ ëª‡ì¼ì§¸?: ì²« í•™ìŠµ í›„ â¤74ì¼ì§¸â¤
ğŸ›‘4ì¼í›„: "ğŸ¥‰4ì¼ë’¤ : 2024/08/18"
ğŸ›‘7ì¼í›„: "ğŸ¥ˆ7ì¼ë’¤ : 2024/08/21"
ğŸ›‘14ì¼í›„: "ğŸ¥‡14ì¼ë’¤ : 2024/08/28"
4ì¼í›„: "@2024ë…„ 8ì›” 18ì¼"
4ì¼í›„(text): 2024/08/18
7ì¼í›„: "@2024ë…„ 8ì›” 21ì¼"
7ì¼í›„(text): 2024/08/21
14ì¼í›„: "@2024ë…„ 8ì›” 28ì¼"
14ì¼í›„(text): 2024/08/28
ì˜¤ëŠ˜1: "@2024ë…„ 10ì›” 27ì¼ ì˜¤í›„ 2:01"
ì˜¤ëŠ˜2: 2024/10/27
ì²«í•™ìŠµë‚ text: 2024/08/14
ì˜¤ëŠ˜ê³¼ ì²«í•™ìŠµë‚  ì‚¬ì´: "74"
ì‚¬ì´: "74"
"1ì¼ì°¨ë³µìŠµì—¬ë¶€1,0": "0"
"4ì¼ì°¨ë³µìŠµì—¬ë¶€1,0": "0"
"7ì¼ì°¨ë³µìŠµì—¬ë¶€1,0": "0"
"ì¥ê¸°ê¸°ì–µì €ì¥ì—¬ë¶€1,0": "0"
í•™ìŠµë¥ : "0"
ì§„í–‰ë°”: â¬œ 0%
---
[https://www.youtube.com/watch?v=InZVNuKY5GY](https://www.youtube.com/watch?v=InZVNuKY5GY)

### ë‹¨ì„œ ì§ˆë¬¸

- ì§ˆë¬¸1

### í•µì‹¬ í•„ê¸°

- ì „ì²´ ë‚´ìš© ì ‘ê¸°
    - ê°œìš”
        
        ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” Distributed Systemì´ë©° iptableë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ í˜¹ì€ iptableì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  eBPFë¥¼ ì‚¬ìš©í•˜ëŠ” ë“± ì»¤ìŠ¤í…€í•˜ê²Œ ë„¤íŠ¸ì›Œí‚¹ì„ ë³€ê²½ ê°€ëŠ¥í•˜ë‹¤.(Plugable)
        
    - ì‹¤ìŠµ í™˜ê²½ ì„¤ì •
        
        ```JavaScript
        git clone https://github.com/korvus81/k8s-net-labs.git
        ```
        
    - ë„¤íŠ¸ì›Œí‚¹ì—ì„œ ìº¡ìŠí™”
        
        ![[Untitled 25.png]]
        
        ì´ë”ë„· í—¤ë”ëŠ” hopì„ í†µí•´ ì´ë™í•  ë•Œë§ˆë‹¤ ë‹¤ìŒ í™‰ì˜ MAC ì£¼ì†Œë¡œ êµì²´ëœë‹¤. ë°˜ë©´ì—, IP í—¤ë”ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ëœë‹¤.
        
    - Docker/Container ë„¤íŠ¸ì›Œí‚¹
        
        ![[Untitled 1 12.png]]
        
        ë¦¬ëˆ…ìŠ¤ì˜ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ í†µí•´ì„œ ë„¤íŠ¸ì›Œí¬ ê°„ì— ê³ ë¦½ì„ ë§Œë“ ë‹¤.
        
        [[ë¦¬ëˆ…ìŠ¤ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë€]]
        
    - Docker ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ
        - Docker Bridge Mode
            
            ![[Untitled 2 10.png]]
            
            ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” Dockerì˜ ë„¤íŠ¸ì›Œí¬ ëª¨ë“œë‹¤.
            
            Dockerì˜ ë„¤íŠ¸ì›Œí¬ ëª¨ë“œë¥¼ ë³€ê²½í•˜ì§€ ì•Šê³  ì‹¤í–‰í•˜ë©´ Docker Bridge ëª¨ë“œë¡œ ì‹¤í–‰ë˜ëŠ”ë° ì´ëŠ” ë„¤íŠ¸ì›Œí¬ì˜ ë£¨íŠ¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— docker0ë¼ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ê°€ì§„ ë¸Œë¦¿ì§€ ë””ë°”ì´ìŠ¤ë¥¼ ë§Œë“ ë‹¤. ê·¸ë¦¬ê³  172.17.0.0/16 ì£¼ì†Œë¥¼ í• ë‹¹í•œë‹¤.(ë§ˆì§€ë§‰ ë‘ ì˜¥í…Ÿì€ ì»¨í…Œì´ë„ˆ IPë¡œ ì‚¬ìš©ëœë‹¤.
            
            ë¸Œë¦¿ì§€ ë””ë°”ì´ìŠ¤(docker0)ëŠ” ì´ë”ë„· ìŠ¤ìœ„ì¹˜ì²˜ëŸ¼ ë™ì‘í•œë‹¤.
            
              
            
            ![[Untitled 3 9.png]]
            
            ì´í›„ì— Docker BridgeëŠ” í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ì™€ ì—°ê²°ëœë‹¤.
            
              
            
            ![[Untitled 4 9.png]]
            
            Dockerê°€ ì»¨í…Œì´ë„ˆë¥¼ ìƒì‚°í•˜ë©´ í•´ë‹¹ ì»¨í…Œì´ë„ˆë¥¼ ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ìƒˆë¡œ ë§Œë“ ë‹¤.
            
              
            
            ![[Untitled 5 6.png]]
            
            DockerëŠ” VETH(Virtual Ethernet)ì´ë¼ëŠ” ê°€ìƒ ì´ë”ë„·ì„ ë§Œë“­ë‹ˆë‹¤.
            
            veth í˜ì–´ ì¤‘ì—ì„œ í•œ ìª½ì€ docker0ì™€ ì—°ê²°ë˜ë©° ë‚˜ë¨¸ì§€ í•œ ìª½ì€ ì»¨í…Œì´ë„ˆì˜ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— eth0ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ í• ë‹¹ëœë‹¤.
            
            ![[%EC%A0%9C%EB%AA%A9_%EC%97%86%EB%8A%94_%EB%8B%A4%EC%9D%B4%EC%96%B4%EA%B7%B8%EB%9E%A8.drawio.svg]]
            
            > [!important]  
            > VETHë€? ê°€ìƒ ì´ë”ë„· ì¸í„°í˜ì´ìŠ¤ë¡œ ì„œë¡œ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì—°ê²°í•˜ê±°ë‚˜, ë¬¼ë¦¬ ë””ë°”ì´ìŠ¤ì™€ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ ì¥ë¹„ë¥¼ ì—°ê²°í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
            
              
            
            ![[Untitled 6 5.png]]
            
            VETHë¥¼ í†µí•´ ì„œë¡œ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì†í•œ docker0ì™€ ì»¨í…Œì´ë„ˆê°€ í†µì‹ ì´ ê°€ëŠ¥í•˜ê²Œ ë©ë‹ˆë‹¤.
            
            ![[Untitled 7 5.png]]
            
            ì „í†µì ìœ¼ë¡œ DockerëŠ” ì»¨í…Œì´ë„ˆì˜ IPë¥¼ ì»¨í…Œì´ë„ˆê°€ ëŒì•„ê°€ëŠ” í˜¸ìŠ¤íŠ¸ë¥¼ ì œì™¸í•˜ê³ ëŠ” ë…¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            
            ì»¨í…Œì´ë„ˆë¡œ ë“¤ì–´ì˜¨ íŠ¸ë˜í”½ì„ ë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„°ì˜ ë…¸ë“œë¡œ ì „ì†¡í•˜ëŠ” ê±´ ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ í•´ê²°í•´ì•¼í•  ë¬¸ì œì…ë‹ˆë‹¤.
            
            - ì‹¤ìŠµ
                
                ```JavaScript
                $ docker network inspect a9d
                [
                    {
                        "Name": "bridge",
                        "Id": "a9d9bb05b409b02ce00c01aeacdcdc7c9e7b498dd8f5a9f22f7ebb05f91bf1e1",
                        "Created": "2024-08-13T10:54:23.044611612+09:00",
                        "Scope": "local",
                        "Driver": "bridge",
                        "EnableIPv6": false,
                        "IPAM": {
                            "Driver": "default",
                            "Options": null,
                            "Config": [
                                {
                                    "Subnet": "172.17.0.0/16",
                                    "Gateway": "172.17.0.1"
                                }
                            ]
                        },
                        "Internal": false,
                        "Attachable": false,
                        "Ingress": false,
                        "ConfigFrom": {
                            "Network": ""
                        },
                        "ConfigOnly": false,
                        "Containers": {
                		        # í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ 
                            "a82aef3a4a9cdae8d6425c607e6643693ab3f77ebcb0a367c299aff8d243109e": {
                                "Name": "alpine",
                                "EndpointID": "35fd9cf2b079e9b294d17fe4acaf5532f720ea87f4cce17fba0e49072f73f4ec",
                                "MacAddress": "02:42:ac:11:00:02",
                                "IPv4Address": "172.17.0.2/16",
                                "IPv6Address": ""
                            }
                        },
                        "Options": {
                            "com.docker.network.bridge.default_bridge": "true",
                            "com.docker.network.bridge.enable_icc": "true",
                            "com.docker.network.bridge.enable_ip_masquerade": "true",
                            "com.docker.network.bridge.host_binding_ipv4": "0.0.0.0",
                            "com.docker.network.bridge.name": "docker0",
                            "com.docker.network.driver.mtu": "1500"
                        },
                        "Labels": {}
                    }
                ]
                ```
                
        - Docker Host Mode
            
            í˜¸ìŠ¤íŠ¸ì˜ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì§ì ‘ ì‚¬ìš©í•©ë‹ˆë‹¤. í˜¸ìŠ¤íŠ¸ì˜ ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì»¨í…Œì´ë„ˆì˜ í¬íŠ¸ì™€ í˜¸ìŠ¤íŠ¸ì˜ í¬íŠ¸ê°€ ì§ì ‘ì ìœ¼ë¡œ ë§¤í•‘ë©ë‹ˆë‹¤.
            
        - Docker Link Mode
            - ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì»¨í…Œì´ë„ˆë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
            - ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì„œ íŒŒë“œëŠ” ì—¬ëŸ¬ ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ 1ê°œì˜ ë„¤íŠ¸ì›Œí¬ ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì‚¬ìš©í•œë‹¤.
        - Container Networking ì‹¤ìŠµ
            
            dockerë¥¼ ì‹¤í–‰í•˜ê³  ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ì—¬ docker0ê°€ ì»¨í…Œì´ë„ˆì™€ ì—°ê²°ëœ ê²ƒì„ í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤.
            
              
            
            ë¨¼ì €, ip addrë¥¼ í†µí•´ í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤.
            
            ```Bash
            $ ip addr
            5: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default 
                link/ether 02:42:e0:ef:c5:b6 brd ff:ff:ff:ff:ff:ff
                inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
                   valid_lft forever preferred_lft forever
                inet6 fe80::42:e0ff:feef:c5b6/64 scope link 
                   valid_lft forever preferred_lft forever
            ```
            
            dockerê°€ ì‹¤í–‰ëœ ìƒíƒœì´ë©´ ìœ„ì²˜ëŸ¼ docker0 ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ë©´ ìœ„ì— docker0ì™€ ì»¨í…Œì´ë„ˆê°€ veth(ê°€ìƒ ì´ë”ë„·) ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì—°ê²°ë  ê²ƒì…ë‹ˆë‹¤.
            
              
            
            dockerë¡œ ì»¨í…Œì´ë„ˆë¥¼ ìƒì‚°í•´ë³´ê² ìŠµë‹ˆë‹¤.
            
            - ì½”ë“œ
                
                ```Bash
                $ for ((i=0; i<2; i++)) do docker run -d --name alpine$i alpine; done
                ```
                
                  
                
            
            IP ì£¼ì†Œë¥¼ ì¶œë ¥í•´ë³´ê² ìŠµë‹ˆë‹¤.
            
            - ì½”ë“œ
                
                ```Bash
                $ ip addr show
                ....
                ....
                5: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default 
                    link/ether 02:42:e0:ef:c5:b6 brd ff:ff:ff:ff:ff:ff
                    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
                       valid_lft forever preferred_lft forever
                    inet6 fe80::42:e0ff:feef:c5b6/64 scope link 
                       valid_lft forever preferred_lft forever
                55: veth6c83a45@if54: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default 
                    link/ether c6:ac:23:74:6f:91 brd ff:ff:ff:ff:ff:ff link-netnsid 0
                    inet6 fe80::c4ac:23ff:fe74:6f91/64 scope link 
                       valid_lft forever preferred_lft forever
                57: veth232dd87@if56: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default 
                    link/ether 0e:2f:6d:55:21:3d brd ff:ff:ff:ff:ff:ff link-netnsid 1
                    inet6 fe80::c2f:6dff:fe55:213d/64 scope link 
                       valid_lft forever preferred_lft forever
                ```
                
            
            ìœ„ì˜ ê²°ê³¼ë¬¼ì„ ë³´ë©´ veth6c83a45@==**if54**== veth232dd87@==**if56**====ê°€ ìƒê¸´ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.==
            
              
            
            ==ì´ì œ ìƒì„±í•œ ì»¨í…Œì´ë„ˆë“¤ë¡œ ë“¤ì–´ê°€ì„œ ip ì£¼ì†Œë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.==
            
            - ì½”ë“œ
                
                ```Bash
                $ docker exec -it alpine0 sh
                / # ip addr show
                1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN qlen 1000
                    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
                    inet 127.0.0.1/8 scope host lo
                       valid_lft forever preferred_lft forever
                54: eth0@if55: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue state UP 
                    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
                    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0
                       valid_lft forever preferred_lft forever
                       
                $ docker exec -it alpine1 sh
                / # ip addr show
                1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN qlen 1000
                    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
                    inet 127.0.0.1/8 scope host lo
                       valid_lft forever preferred_lft forever
                56: eth0@if57: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue state UP 
                    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff
                    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0
                       valid_lft forever preferred_lft forever
                
                $ brctl show
                bridge name	bridge id		STP enabled	interfaces
                docker0		8000.0242e0efc5b6	no		veth232dd87
                							veth6c83a4
                ```
                
                  
                
                ì»¨í…Œì´ë„ˆ ê°„ì— pingì„ ë‚ ë¦¬ê³  ì—°ê²° ìƒíƒœ í™•ì¸í•˜ê¸°
                
                ```Bash
                # ip neigh
                172.17.0.3 dev eth0 lladdr 02:42:ac:11:00:03 used 0/0/0 probes 1 STALE
                
                # ping -c 2 172.17.0.3
                PING 172.17.0.3 (172.17.0.3): 56 data bytes
                64 bytes from 172.17.0.3: seq=0 ttl=64 time=0.215 ms
                64 bytes from 172.17.0.3: seq=1 ttl=64 time=0.151 ms
                
                --- 172.17.0.3 ping statistics ---
                2 packets transmitted, 2 packets received, 0% packet loss
                round-trip min/avg/max = 0.151/0.183/0.215 ms
                
                # ip neigh
                172.17.0.3 dev eth0 lladdr 02:42:ac:11:00:03 ref 1 used 0/0/0 probes 1 DELAY
                
                # ip neigh
                172.17.0.3 dev eth0 lladdr 02:42:ac:11:00:03 ref 1 used 0/0/0 probes 1 REACHABLE
                ```
                
    - IPs in Kubernetes(20:17)
        - Pod IP
            
            - ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ íŒŒë“œëŠ” ê³ ìœ  IPë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ íŒŒë“œì™€ íŒŒë“œë¼ë¦¬ í†µì‹ ì„ í•œë‹¤.
            - kube-apiserverëŠ” 172.16.0.0/16ì´ë¼ëŠ” í”Œë˜ê·¸ê°’ì„ ëª…ì‹œí•˜ì—¬ íŒŒë“œì˜ IP ë²”ìœ„ë¥¼ ëª…ì‹œí•œë‹¤.
            
            - íŒŒë“œì˜ IP ë²”ìœ„ êµ¬í•˜ê¸°
                
                ```JavaScript
                # kubectl cluster-info dump | grep -- --cluster-cidr | xargs
                --cluster-cidr=172.16.0.0/16,
                ```
                
            
              
            
        - Service IP
            
            - ì„œë¹„ìŠ¤ëŠ” íŒŒë“œì™€ ì—°ê²°ë˜ì–´ ì„œë¹„ìŠ¤ë¥¼ í†µí•œ ìš”ì²­ì€ íŒŒë“œë¡œ ì „ë‹¬ëœë‹¤.
            - ì„œë¹„ìŠ¤ IPëŠ” kube-apiserverì—ì„œ í• ë‹¹í•˜ë©° ì´ë¥¼ kubeletì— ì „ë‹¬í•œë‹¤. kubeletì€ ì´ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ê³  íŒŒë“œë¥¼ í•´ë‹¹ ì„œë¹„ìŠ¤ì— í• ë‹¹í•œë‹¤.
            
            - [ì½”ë“œ] ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤ IP ë²”ìœ„ êµ¬í•˜ê¸°
                
                ```JavaScript
                # kubectl cluster-info dump | grep -m 1 service-cluster-ip-range | xargs
                "--service-cluster-ip-range=10.96.0.0/12",
                ```
                

### í•µì‹¬ ìš”ì•½

- í•µì‹¬ ìš”ì•½ ì ‘ê¸°
    - í•™ìŠµë‚´ìš©ì„ ëª‡ë¬¸ì¥ìœ¼ë¡œ ì••ì¶•í•˜ì—¬ ì •ë¦¬í•œë‹¤.

### ë³µìŠµì•Œë¦¼

- 
- ìë™ìœ¼ë¡œ í•¸ë“œí°ì— ì•Œë¦¼ì´ ì˜¤ë„ë¡ ì„¤ì •í•˜ê³  ì‹¶ìœ¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•œë‹¤.

> [!important]  
> 